---
import Button from "@/components/ui/button.astro";
const { headings } = Astro.props;

const filteredHeadings = (headings ?? []).filter(
  (heading: { depth: number }) => heading.depth < 4,
);

const highlightRules = filteredHeadings
  .map(
    (heading: { slug: string }) => `
:root:has(#${heading.slug}:target) .toc-container li:has(.toc-link[href="#${heading.slug}"]) {
  border-color: var(--accent);
}

:root:has(#${heading.slug}:target) .toc-container .toc-link[href="#${heading.slug}"] {
  color: var(--foreground);
}
`,
  )
  .join("");

const tocStyles = `${highlightRules}`;
---

<div class="toc-container sticky top-24 mx-auto">
  <h3 class="text-xl font-semibold mb-4">On this page</h3>
  <ul class="space-y-2 text-sm text-muted-foreground border-l border-border/40">
    {
      filteredHeadings.map((heading: any) => (
        <li class="border-l-2 border-transparent hover:border-accent">
          <Button
            href={`#${heading.slug}`}
            variant="ghost"
            size="sm"
            class="toc-link w-full justify-start overflow-hidden rounded-none whitespace-normal"
          >
            {heading.text}
          </Button>
        </li>
      ))
    }
  </ul>
</div>

{filteredHeadings.length > 0 && <style is:global set:html={tocStyles} />}
